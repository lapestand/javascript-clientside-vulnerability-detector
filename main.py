import os
import argparse
import logging
import json

from src import utils
from src.DomBasedXssScanner.Scanner import *

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description="DOM BASED XSS SCANNER")
    parser.add_argument("--url", help="Target website url", required=True)
    parser.add_argument("-v", "--verbose", help="Increase verbosity level", action="store_true")
    args = parser.parse_args()

    if args.verbose:
        logging.basicConfig(level=logging.DEBUG)
        logging.info("Verbosity ON")

    # target_dir = os.path.join(utils.dest_path, args.url)
    # logging.info(f"Target directory: {target_dir}")

    sess = utils.get_session(args.url)
    scripts = utils.get_scripts(args.url, sess)


    parsed_scripts = []
    not_parsed = []
    for sc in scripts:
        try:
            parsed_scripts.append(utils.parse(sc[-1]))
        except Exception as e:
            not_parsed.append([sc, e])
    # parsed_scripts = [utils.parse(script[-1]) for script in scripts]

    """
    for sc in parsed_scripts:
        print(json.dumps(sc, indent=4))
        print("\n"*3 + "**"*15)
    """

    # scanner = StaticAnalyzer()
    # scanner.scan(args.url)




"""
google xss
http://vulnweb.com/
http://www.insecurelabs.org/Task/
public-firing-range.appspot.com

https://youtu.be/xXbDhyKo9B8?t=770

https://owasp.org/www-community/attacks/DOM_Based_XSS
http://projects.webappsec.org/w/page/13246920/Cross%20Site%20Scripting
https://www.cgisecurity.com/xss-faq.html
http://www.webappsec.org/projects/articles/071105.shtml#r8

https://owasp.org/projects/
https://owasp.org/www-community/
"""
