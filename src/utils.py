import os
import pathlib
import subprocess

target_file_types = ["html", "js"]
dest_path = os.path.join(pathlib.Path(__file__).parent.absolute(), "..", "data")


def download_page(page_url):
    print("dest_path is ---->   ", dest_path)
    command = ["wget", "-A", ",".join(target_file_types), "-e", "robots=off", "-p", "-k", page_url, "-P", dest_path]
    command = ["wget", "-A", ",".join(target_file_types), "-r", "--np", page_url]
    command = ["wget", "-A", ",".join(target_file_types), "-m", "-p", "-E", "-k", "-np", page_url]
    subprocess.Popen(command).wait()

    page_dir = page_url.split('/')[2] if page_url.startswith("http") else page_url.split('/')[0]
    html_files = list()
    js_files = list()
    for (root, dirs, files) in os.walk(page_dir):
        print(f"""\t root -> {root} 
        \t dir -> {dirs}
        \t files -> {[file for file in files if (".html" in file.lower()) or (".js" in file.lower())]}
        *************************""")
        html_files.extend([os.path.join(root, file) for file in files if ".html" in file.lower()])
        js_files.extend([os.path.join(root, file) for file in files if ".js" in file.lower()])

    print(html_files)
    for html_file in html_files:
        with open(html_file, 'r', encoding='ISO-8859-1') as f:
            print(f.readlines())
            break
    print(js_files)
