from requests_html import HTMLSession
from urllib.parse import urljoin, urlparse
import pyjsparser
import jsbeautifier

def get_session(url):
    session = HTMLSession()
    try:
        url = urlparse(url, "https").geturl()
        return session.get(url)
    except:
        url = urlparse(url, "http").geturl()
        return session.get(url)
    # https://requests-html.kennethreitz.org/_static/doctools.js
    
    
def get_scripts(url, session):
    scripts = []
    for script in session.html.find("script"):
        current = []
        if "src" in script.attrs:
            current.append("linked")
            current.append(get_session(urljoin(url, script.attrs["src"])).html.text)
        else:
            current.append("inline")
            current.append(script.text)
        scripts.append(current)
    return scripts

def parse(js_content):
    return pyjsparser.parse(jsbeautifier.beautify(js_content))